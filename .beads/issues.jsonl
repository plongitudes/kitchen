{"id":"rk-1","title":"CRITICAL: Notification system over-engineered for MVP","description":"Per-user, per-event, multi-timing, multi-delivery notification system adds massive complexity. Current spec requires ~36+ scheduled jobs with dynamic job creation.","design":"Simplify to: single global Discord channel, fixed time (7am), no per-user preferences. Use global settings table instead of notification_preferences table.","acceptance_criteria":"- notification_preferences table removed from spec\n- settings table added with discord_bot_token, channel_id, notification_time, timezone\n- US-29, US-20, US-21, US-22 updated to reflect simplified system\n- Only 2 APScheduler jobs needed (daily notifications + week advancement)","notes":"DECISION: Simplified to global settings approach\n- Single Discord channel (no DMs, no per-user prefs)\n- Fixed time: 7am on day of event\n- Configurable notification_time + notification_timezone in settings\n- Server runs in UTC, converts to user timezone for notifications\n- Remove notification_preferences table entirely\n- Add settings table with: discord_bot_token, notification_channel_id, notification_time, notification_timezone\n- Move discord_bot_token from schedule_sequences to settings (also addresses rk-5)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-29T22:00:33.219602-07:00","updated_at":"2025-10-29T22:45:27.572781-07:00","closed_at":"2025-10-29T22:45:27.572781-07:00"}
{"id":"rk-10","title":"Notion migration is partially manual, not automated","description":"Migration plan implies automation but requires significant manual work: parsing recipes (automatable), creating week templates (manual), assigning recipes to days (manual).","design":"Set expectations: recipe import script + manual setup phase for week templates/assignments.","acceptance_criteria":"- Section 13 updated with realistic migration steps\n- Distinction between automated (recipes) and manual (schedules) is clear","notes":"Clarified migration expectations in Section 13\n\nSplit into two clear phases:\n\nAUTOMATED (1-2 hours):\n- Recipe import script\n- Parse CSV + markdown files\n- Normalize units\n- Import to database\n- Validation checks\n\nMANUAL (2-4 hours):\n- Create schedule sequence\n- Define themed week templates\n- Assign people/actions/recipes to days\n- Set up first instance\n\nTESTING (1-2 hours):\n- End-to-end validation\n- Cutover from Notion\n\nTotal realistic estimate: 4-6 hours\nPrevious spec implied full automation, now clear about manual schedule setup work.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-29T22:00:35.424489-07:00","updated_at":"2025-10-30T10:27:18.12799-07:00","closed_at":"2025-10-30T10:27:10.668063-07:00"}
{"id":"rk-11","title":"Missing MVP features: error handling, loading states, auth flows","description":"Requirements don't specify: error messages, loading states (critical for ADHD UX), Discord linking UX, first-time setup wizard, password reset, JWT refresh, Discord offline handling.","design":"Add user stories or design notes for: error UX, loading indicators, empty states, Discord setup flow, auth edge cases.","acceptance_criteria":"- Key UX patterns documented\n- Auth flows clarified\n- Discord setup process defined","notes":"Added comprehensive UX patterns section to Section 11\n\nDocumented:\n\nLOADING STATES:\n- Spinners/skeleton UI for API calls (ADHD-friendly)\n- Disabled buttons during form submission\n- Progress indicators for long operations\n- Route transition loading\n\nERROR HANDLING:\n- Inline validation errors\n- Toast notifications for API errors\n- Connection lost banner with retry\n- Permission error messages\n- Retry buttons for failed calls\n\nEMPTY STATES:\n- No recipes, templates, instances, or grocery lists\n- Clear CTAs for first-time users\n- Helpful guidance messages\n\nAUTHENTICATION FLOWS:\n- Simple login/registration (no email verification)\n- JWT 7-day expiry with redirect\n- No password reset in MVP (2-person system)\n- Session stored in localStorage/cookie\n\nDISCORD SETUP:\n- 6-step manual setup process documented\n- Token validation flow\n- Connection status display\n- No OAuth in MVP (manual token sufficient)\n\nAll patterns align with ADHD-friendly, low-friction UX goals.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-29T22:00:35.651215-07:00","updated_at":"2025-10-30T10:27:59.694765-07:00","closed_at":"2025-10-30T10:27:50.647913-07:00"}
{"id":"rk-12","title":"Final requirements critique and validation","description":"Conduct final review of REQUIREMENTS.md with fresh eyes after all critique changes. Ensure all critical issues are addressed, data model is consistent, and MVP scope is clear.","acceptance_criteria":"- All sections of REQUIREMENTS.md reviewed\n- Data model consistency verified\n- API endpoints align with data model\n- User stories are clear and complete\n- No blocking issues or contradictions found\n- Ready to lock in for Phase 1 implementation","status":"open","priority":1,"issue_type":"task","created_at":"2025-10-30T10:36:59.93238-07:00","updated_at":"2025-10-30T10:36:59.93238-07:00"}
{"id":"rk-13","title":"Lock in Phase 1 requirements","description":"Mark REQUIREMENTS.md as final for Phase 1 MVP. Update PROJECT_STATUS.md to reflect requirements completion and readiness for implementation.","acceptance_criteria":"- REQUIREMENTS.md marked as \"Phase 1 Final\" with version/date\n- PROJECT_STATUS.md updated with completion status\n- All critique issues (rk-1 through rk-11) documented as resolved\n- Clear handoff to implementation phase","status":"open","priority":1,"issue_type":"task","created_at":"2025-10-30T10:37:00.087247-07:00","updated_at":"2025-10-30T10:37:00.087247-07:00","dependencies":[{"issue_id":"rk-13","depends_on_id":"rk-12","type":"blocks","created_at":"2025-10-30T10:37:00.08835-07:00","created_by":"daemon"}]}
{"id":"rk-14","title":"Break down Phase 1 into implementation tasks","description":"Decompose Phase 1 MVP into concrete development tasks covering backend, frontend, database, API, UI, Discord integration, and deployment.","design":"Create beads issues for major components:\n- Backend setup (FastAPI, PostgreSQL, Docker, SQLAlchemy)\n- Database schema implementation (9 tables with migrations)\n- Authentication system (JWT, bcrypt, session management)\n- Recipe management API + UI (CRUD, ingredients, instructions)\n- Schedule management API + UI (sequences, templates, instances)\n- Grocery list generation API + UI (Pint integration, aggregation)\n- Discord bot integration (notifications, settings)\n- Notion migration script\n- Testing suite\n- Deployment to Unraid","acceptance_criteria":"- All major components have dedicated beads issues\n- Issues include effort estimates\n- Dependencies between issues identified\n- Clear acceptance criteria for each issue\n- Ready to start implementation","status":"open","priority":1,"issue_type":"task","created_at":"2025-10-30T10:37:00.224072-07:00","updated_at":"2025-10-30T10:37:00.224072-07:00","dependencies":[{"issue_id":"rk-14","depends_on_id":"rk-13","type":"blocks","created_at":"2025-10-30T10:37:00.22515-07:00","created_by":"daemon"}]}
{"id":"rk-15","title":"Estimate effort and sequence Phase 1 work","description":"Review all Phase 1 implementation tasks, estimate effort, identify critical path, and create recommended sequence for development.","design":"For each component:\n- Estimate hours/days of effort\n- Identify dependencies and blockers\n- Determine parallel vs sequential work\n- Create recommended sprint/milestone structure\n- Flag high-risk or complex areas","acceptance_criteria":"- Effort estimates documented for all tasks\n- Critical path identified\n- Recommended development sequence defined\n- Sprint/milestone structure proposed\n- Risk areas flagged","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-30T10:37:00.360731-07:00","updated_at":"2025-10-30T10:37:00.360731-07:00","dependencies":[{"issue_id":"rk-15","depends_on_id":"rk-14","type":"blocks","created_at":"2025-10-30T10:37:00.361575-07:00","created_by":"daemon"}]}
{"id":"rk-16","title":"Set up initial project structure","description":"Create foundational project structure for backend and frontend. Initialize git repo structure, Docker configs, package files, and basic scaffolding.","design":"Create:\n- /backend (FastAPI app structure)\n- /frontend (React + Vite scaffold)\n- docker-compose.yml\n- .gitignore\n- README.md with setup instructions\n- requirements.txt / package.json\n- Basic folder structure following best practices","acceptance_criteria":"- Backend and frontend directories exist with proper structure\n- Docker compose configured for local development\n- Package managers initialized\n- README with setup instructions\n- Can run `docker-compose up` successfully\n- Basic \"Hello World\" endpoints/pages work","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-30T10:37:00.532357-07:00","updated_at":"2025-10-30T10:37:00.532357-07:00","dependencies":[{"issue_id":"rk-16","depends_on_id":"rk-15","type":"blocks","created_at":"2025-10-30T10:37:00.534037-07:00","created_by":"daemon"}]}
{"id":"rk-17","title":"Resolve high-priority requirements gaps (4 issues)","description":"Address 4 high-priority specification gaps identified during requirements critique that need resolution before Phase 1 implementation.","design":"Issues to resolve:\n\n#3: Recipe retirement validation logic\n- Define what \"actively used\" means exactly\n- Add GET /recipes/{id}/usage endpoint\n- Specify bulk \"remove from templates\" action\n- Add API for listing/restoring retired recipes\n\n#4: Week advancement race condition\n- Add mutex/check to prevent double advancement\n- Skip auto-advancement if manual advance within 12 hours\n- Document in Section 12\n\n#5: Migration complexity estimate\n- Update Section 13 from \"1-2 hours\" to \"4-6 hours\"\n- Account for missing owners, unstructured ingredients\n- Add data cleanup phase\n\n#6: Soft delete vs CASCADE conflict\n- Clarify when to use hard delete vs soft delete\n- Document that application only uses soft delete\n- Note that CASCADE allows hard delete but shouldn't be used","acceptance_criteria":"- Recipe retirement validation rules fully specified\n- Race condition mitigation documented\n- Migration timeline updated to realistic estimate\n- Soft delete vs hard delete usage clarified\n- All 4 issues documented in REQUIREMENTS.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-30T12:45:38.556734-07:00","updated_at":"2025-10-30T13:24:03.445328-07:00","closed_at":"2025-10-30T13:24:03.445328-07:00"}
{"id":"rk-18","title":"Resolve medium-priority requirements gaps (6 issues)","description":"Address 6 medium-priority specification gaps that should be documented before Phase 1 implementation begins.","design":"Issues to resolve:\n\n#7: Week template validation rules\n- Require at least 1 shopping day per week\n- \"cook\" action requires recipe (validate in app)\n- Allow multiple assignments per day (sorted by order)\n\n#8: Discord bot token security\n- Use environment variable instead of DB encryption\n- Update line 100 in data model\n\n#9: Grocery list aggregation edge cases\n- Document \"to_taste\" + quantity aggregation behavior\n- Document can size aggregation limitation\n- Document incompatible units as MVP limitation\n- Add to Section 12\n\n#10: Database migration strategy\n- Add brief section in Architecture\n- Specify Alembic + SQLAlchemy\n- Document initial migration and versioning\n\n#11: API error format\n- Add API Conventions subsection\n- Define error response JSON structure\n- Document HTTP status codes (400/422/404/409)\n\n#12: JWT refresh strategy\n- Implement sliding window (extend on each request)\n- Or accept 7-day hard logout and document it","acceptance_criteria":"- Week template validation rules documented\n- Discord token security approach specified\n- Grocery list edge cases documented as MVP limitations\n- Database migration strategy added to Architecture section\n- API error format specified with examples\n- JWT refresh strategy chosen and documented","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-30T12:45:38.671156-07:00","updated_at":"2025-10-30T20:20:06.213119-07:00","closed_at":"2025-10-30T20:20:06.213119-07:00"}
{"id":"rk-19","title":"Document minor requirements gaps (7 items)","description":"Document 7 minor specification gaps that won't block development but should be added for completeness.","design":"Items to document:\n\n#13: Ingredient/instruction reordering UI pattern\n- Specify drag-drop or up/down buttons for reordering\n\n#14: Discord message length handling\n- 2000 character limit for messages\n- Split long grocery lists or upload as file\n\n#15: Docker Compose configuration\n- Port mappings\n- Volume mounts\n- Environment variables\n- Network configuration\n\n#16: Health check endpoints\n- /health endpoint for Docker monitoring\n- /ready endpoint for readiness checks\n\n#17: Backup restoration procedure\n- Document how to restore from SQL dumps\n- Add to deployment section\n\n#18: APScheduler integration details\n- Job store configuration (memory vs database)\n- FastAPI startup integration\n- Job failure handling\n\n#19: Concurrent editing strategy\n- Document last-write-wins acceptable for 2 users\n- Note as MVP limitation","acceptance_criteria":"- All 7 items have brief documentation added\n- UI patterns specified where needed\n- Technical details provided for deployment items\n- Known limitations documented appropriately","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-30T12:45:38.83106-07:00","updated_at":"2025-10-30T20:36:45.986869-07:00","closed_at":"2025-10-30T20:36:45.986869-07:00"}
{"id":"rk-2","title":"CRITICAL: Grocery list data model breaks with multiple shopping days","description":"grocery_lists table has meal_plan_instance_id (one-to-many), but multiple \"shop\" actions in one week will conflict. Data model assumes one list per week instance.","design":"Change relationship to allow multiple grocery_lists per meal_plan_instance. Each shopping day generates its own list.","acceptance_criteria":"- Confirm data model allows multiple grocery_lists per instance\n- Update API endpoints to handle multiple lists per week\n- Update US-17 to clarify one list per shopping day","notes":"DECISION: Keep week instances as calendar weeks (user-friendly), handle cross-instance grocery lists in backend\n\nKey decisions:\n- Week instances = calendar weeks (Sun-Sat typical) for user mental model\n- Grocery lists can span multiple week instances (backend handles complexity)\n- One shopping day per week in typical usage (data model supports multiple)\n- List covers day AFTER shopping through next shopping day (inclusive)\n- Shopping day itself excluded from list\n- Example: Shop Monday → list covers Tue-Mon (next week)\n\nChanges made:\n- Added note to grocery_lists table schema\n- Updated US-17 to clarify boundary logic and cross-instance support\n- Changed API from POST /grocery-lists/generate to POST /meal-plans/{instance_id}/grocery-lists/generate?shopping_date=YYYY-MM-DD\n- Added GET /meal-plans/{instance_id}/grocery-lists endpoint\n- Documented generation algorithm in Section 12\n- Closed rk-9 (cross-week boundary) as resolved by this design","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-29T22:00:33.373774-07:00","updated_at":"2025-10-30T09:48:13.996606-07:00","closed_at":"2025-10-30T09:48:03.346414-07:00"}
{"id":"rk-20","title":"Establish testing infrastructure and coverage tracking","description":"Set up testing framework, CI pipeline for coverage reporting, and establish baseline tests to guide development quality throughout Phase 1.","design":"**Testing Infrastructure:**\n- pytest + fixtures + factories (backend)\n- Jest + React Testing Library (frontend)  \n- Playwright for E2E (optional for MVP)\n- Coverage.py for backend coverage reporting\n- Jest coverage for frontend\n\n**CI/CD Integration:**\n- GitHub Actions or similar\n- Run tests on every PR\n- Block merge if coverage drops below 80%\n- Generate coverage reports\n\n**Coverage Tracking:**\n- Target: 80% overall coverage\n- Business logic: 90%\n- API endpoints: 80%\n- UI components: 60%\n\n**Test Organization:**\n- /backend/tests/unit/ - isolated function tests\n- /backend/tests/integration/ - API + DB tests\n- /frontend/tests/unit/ - component tests\n- /frontend/tests/integration/ - user flow tests\n- /e2e/ - full-stack tests\n\n**Quality Gates:**\n- All tests must pass before merge\n- Coverage must not decrease\n- Critical paths must have tests before feature considered \"done\"","acceptance_criteria":"- pytest and Jest configured with coverage reporting\n- CI pipeline running tests automatically\n- Coverage badge/report visible\n- Test structure documented in README\n- Baseline tests passing (health check, DB connection, basic CRUD)","notes":"Simplified for MVP - removed CI/CD enforcement, removed Playwright E2E, made 80% coverage aspirational not enforced. Focus on pytest/Jest setup and writing tests alongside features.","status":"open","priority":1,"issue_type":"task","created_at":"2025-10-30T20:51:51.949535-07:00","updated_at":"2025-10-30T20:55:38.964625-07:00"}
{"id":"rk-21","title":"Test coverage validation for each feature","description":"Meta-issue to track test coverage as features are implemented. Each feature should reference this issue when adding tests.","design":"**Feature Test Checklist (use for each feature):**\n\nHigh Priority Tests (Required for MVP):\n- [ ] Unit: Business logic isolated\n- [ ] Integration: API endpoints with DB\n- [ ] E2E: Critical user journey\n\nMedium Priority Tests (Include if time):\n- [ ] Integration: External service interactions (Discord, etc.)\n- [ ] Integration: Scheduled jobs\n- [ ] Unit: Edge cases and validation\n\n**Coverage Requirements Per Feature:**\n- New business logic: 90% coverage minimum\n- New API endpoints: 80% coverage minimum\n- New UI components: 60% coverage minimum\n\n**Process:**\n1. Write tests alongside feature code (TDD encouraged)\n2. Run coverage report before marking feature complete\n3. Add regression tests when bugs are fixed\n4. Update this issue with feature test status\n\n**Tracking:**\nComment on this issue when completing tests for major features with coverage report snippet","acceptance_criteria":"- Every feature implementation issue references this issue\n- Coverage reports show 80%+ overall\n- High priority test scenarios all covered\n- Medium priority Discord/APScheduler tests included","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-30T20:51:52.091938-07:00","updated_at":"2025-10-30T20:51:52.091938-07:00"}
{"id":"rk-3","title":"CRITICAL: Unit normalization not addressed for grocery aggregation","description":"Free-form unit strings (cups, tsp, teaspoon, Tsp, lbs, g) won't aggregate correctly. US-18 promises ingredient aggregation but implementation is impossible without unit normalization.","design":"Options: (A) Define unit enum + conversion table, (B) Skip aggregation in MVP and list ingredients separately per recipe, (C) Defer grocery lists to Phase 2","acceptance_criteria":"- Decision made on unit handling approach\n- Data model updated if enum chosen\n- US-18 updated to match chosen approach","notes":"DECISION: Use Pint library for unit-aware aggregation\n\nKey decisions:\n- Use Pint (https://pint.readthedocs.io/) - mature, well-maintained Python library for unit conversions\n- Pint has built-in cooking units (cup, tablespoon, teaspoon, fluid_ounce, pint, quart, gallon, ml, liter)\n- NO schema change needed (no unit_dimension column) - Pint detects dimensionality at runtime\n- Constrain unit field to valid values (volume, weight, count, special units)\n\nAggregation approach:\n- Group by ingredient_name (case-insensitive)\n- Use Pint to determine dimensionality (volume, weight, count)\n- Convert same-dimension units to canonical form (e.g., all volume → cups, all weight → grams)\n- Sum quantities within dimension\n- Incompatible dimensions appear as separate items (e.g., \"1 cup butter\" + \"8 oz butter\")\n\nAcceptable MVP limitation:\n- Volume ↔ weight conversions require ingredient density (deferred to Phase 2)\n- Users keep recipes consistent or mentally convert mixed units\n\nChanges made:\n- Updated recipe_ingredients schema with unit constraints and valid unit list\n- Updated US-18 to document Pint-based aggregation with examples\n- Added new Section 12 subsection \"Unit-Aware Ingredient Aggregation\" with algorithm\n- Added Pint to tech stack (Section 8)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-10-29T22:00:33.502238-07:00","updated_at":"2025-10-30T10:00:48.556591-07:00","closed_at":"2025-10-30T10:00:36.492161-07:00"}
{"id":"rk-4","title":"MAJOR: Week template vs instance data model inconsistency","description":"Spec says instances are read-only in MVP, but meal_assignments table exists for instance-level assignments. Unclear if this table is used or just future-proofing.","design":"Options: (A) Remove meal_assignments in MVP, instances just reference templates, (B) Allow modifications in MVP, (C) Keep unused table for Phase 2","acceptance_criteria":"- Decision documented in requirements\n- Data model matches decision (table present or removed)\n- US-14, US-16 updated to clarify instance behavior","notes":"DECISION: Remove meal_assignments table from MVP (Option A)\n\nKey decisions:\n- Instances are read-only references to templates in MVP\n- No meal_assignments table - all assignments queried from week_day_assignments on-demand\n- Dates calculated: instance_start_date + day_of_week offset\n- Simpler implementation: fewer tables, less code, no data copying\n- Historical accuracy not needed for MVP (if template changes, past instances show new data)\n\nPhase 2 migration path:\n1. Add meal_assignments table\n2. Optionally backfill historical instances (copy template assignments with dates)\n3. Enable instance-level editing in UI\n\nTrade-offs accepted for MVP:\n- Can't see \"what we actually ate\" if template was modified after the fact\n- Must edit templates to change recurring schedules (can't do one-off changes)\n\nChanges made:\n- Removed meal_assignments table from data model (Section 5)\n- Added note to meal_plan_instances explaining template reference approach\n- Updated US-14: assignments derived from template with calculated dates\n- Updated US-16: instances created as references, not snapshots\n- Updated API endpoint descriptions to note \"derived from template\"\n- Updated Section 12 to document Phase 2 migration path with table addition","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-29T22:00:33.64552-07:00","updated_at":"2025-10-30T10:09:08.980362-07:00","closed_at":"2025-10-30T10:08:56.379115-07:00"}
{"id":"rk-5","title":"MAJOR: Discord bot token stored per-sequence instead of globally","description":"schedule_sequences table has discord_bot_token field, but logically bot should be global to app, not per-sequence.","design":"Move to global settings table (already addressed in notification simplification)","acceptance_criteria":"- discord_bot_token removed from schedule_sequences table\n- Token moved to settings table\n- Data model section updated","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-29T22:00:33.915197-07:00","updated_at":"2025-10-29T22:45:27.632241-07:00","closed_at":"2025-10-29T22:45:27.632241-07:00"}
{"id":"rk-6","title":"MAJOR: Missing cascade delete specifications for foreign keys","description":"Foreign keys defined throughout data model but no ON DELETE behavior specified. What happens when deleting users with recipes, recipes in templates, templates with instances?","design":"Add explicit CASCADE, RESTRICT, or SET NULL rules for each foreign key relationship to prevent orphaned data.","acceptance_criteria":"- Every foreign key in data model has ON DELETE behavior documented\n- Rules prevent data integrity issues\n- Edge cases documented (e.g., can't delete user if they own recipes)","notes":"DECISION: All foreign keys have explicit ON DELETE behavior\n\nCASCADE (child dies with parent):\n- recipe_ingredients → recipes\n- recipe_instructions → recipes\n- week_day_assignments → schedule_weeks\n- grocery_lists → meal_plan_instances\n- grocery_list_items → grocery_lists\n\nRESTRICT (prevent deletion if references exist):\n- recipes.owner_id → users (can't delete user with recipes)\n- week_day_assignments.assigned_user_id → users (can't delete user in templates)\n- week_day_assignments.recipe_id → recipes (can't delete recipe in templates)\n- schedule_weeks → schedule_sequences (can't delete sequence with templates)\n- meal_plan_instances → schedule_weeks (can't delete template with instances)\n\nRetirement pattern (soft delete):\n- Recipes: retired_at timestamp (already in schema)\n- Week templates: retired_at timestamp (ADDED to schema)\n- Users: no deletion in MVP (deferred to Phase 2)\n\nEdge cases documented:\n- User deletion deferred to Phase 2 (2-person system doesn't need it)\n- Recipe retirement validated (can't retire if in active templates)\n- Week template retirement preserves historical instance references\n- Sequence deletion requires removing/retiring templates first\n\nPhase 2 note added:\n- Centralized ingredient management with brand preferences/sourcing\n- Ingredients become independent entities (outlive recipes)\n\nChanges made:\n- Added ON DELETE behavior to all 10 FK relationships in data model\n- Added retired_at to schedule_weeks table\n- Updated retirement section to cover both recipes and templates\n- Added new \"Foreign Key Deletion Constraints\" section in Section 12\n- Documented all CASCADE and RESTRICT relationships\n- Added edge cases for user/recipe/template deletion\n- Added \"Centralized ingredient management\" to Phase 2 OUT list\n- Added \"User deactivation/deletion functionality\" to Phase 2 OUT list","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-29T22:00:34.330451-07:00","updated_at":"2025-10-30T10:23:45.99206-07:00","closed_at":"2025-10-30T10:23:34.208694-07:00"}
{"id":"rk-7","title":"MAJOR: Recipe retirement can break active meal plans","description":"US-4 allows retiring recipes, but no validation if recipe is scheduled in future week instances or templates.","design":"Add validation: prevent retiring recipes in active/future meal plans, or show warning with affected schedules.","acceptance_criteria":"- Retirement API checks for active usage\n- UI shows warning if recipe is in use\n- US-4 updated with validation behavior","notes":"DECISION: Validate recipe retirement, prevent if in active templates\n\nValidation approach:\n- Check if recipe is used in any week_day_assignments (active templates)\n- If in use, return 400 error with list of templates using the recipe\n- User must either remove recipe from templates or retire the templates first\n- UI shows helpful modal with template links for easy navigation\n\nAlready addressed in rk-6:\n- week_day_assignments.recipe_id has ON DELETE RESTRICT\n- Can't delete recipes in active templates (database enforces this)\n- Retirement validation documented in Section 12\n\nChanges made:\n- Updated US-4 to include validation behavior and user requirements\n- Added GET /recipes/{id}/usage endpoint to check template usage\n- Updated DELETE /recipes/{id} endpoint docs with validation details (returns 400 with template list)\n- Added Recipe Retirement UI section in Section 11 with modal design\n- Modal shows which templates use the recipe with navigation links\n\nImplementation notes:\n- Validation query: SELECT week templates WHERE week_day_assignments.recipe_id = {id} AND schedule_weeks.retired_at IS NULL\n- Error response includes template IDs, names, and themes for UI display\n- UI modal allows direct navigation to affected templates","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-10-29T22:00:34.613703-07:00","updated_at":"2025-10-30T10:25:38.438584-07:00","closed_at":"2025-10-30T10:25:26.583489-07:00"}
{"id":"rk-8","title":"Schedule advancement edge cases not documented","description":"Missing specs: initial setup (which week starts first?), manual advancement impact on auto-schedule, system downtime recovery, timezone handling.","design":"Document: initial state behavior, manual override logic, catch-up on restart, timezone conversion for advancement_time.","acceptance_criteria":"- Edge cases documented in requirements\n- Implementation approach clear for MVP","notes":"Documented all schedule advancement edge cases in Section 12\n\nCovered scenarios:\n1. Initial setup: current_week_index starts at 0, first instance created on startup or manually\n2. Manual advancement: doesn't affect auto-schedule, can cause double advancement if timed poorly\n3. System downtime: catch up once on restart (not multiple times for multiple missed weeks)\n4. Timezone handling: advancement_time interpreted in notification_timezone, converted to UTC\n5. Sequence looping: reset to index 0 after reaching end of sequence\n\nImplementation guidance provided for each scenario.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-29T22:00:34.918847-07:00","updated_at":"2025-10-30T10:26:31.705279-07:00","closed_at":"2025-10-30T10:26:24.116498-07:00"}
{"id":"rk-9","title":"Cross-week grocery list boundary not clarified","description":"US-17 says grocery list covers \"shopping day forward until next shopping day\" but what if that spans two meal_plan_instance records?","design":"Options: (A) Generate per-week only in MVP, (B) Handle multi-week spans with cross-instance queries","acceptance_criteria":"- US-17 clarified with chosen approach\n- Query logic documented","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-29T22:00:35.177318-07:00","updated_at":"2025-10-30T09:47:53.416168-07:00","closed_at":"2025-10-30T09:47:53.416168-07:00"}
